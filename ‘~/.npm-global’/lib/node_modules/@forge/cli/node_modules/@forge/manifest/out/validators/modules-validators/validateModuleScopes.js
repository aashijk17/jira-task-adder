"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateModuleScopes = void 0;
const text_1 = require("../../text");
const utils_1 = require("../../utils");
const module_to_scope_mapping_1 = require("../../mapping/module-to-scope-mapping");
const scopes_1 = require("../../utils/scopes");
const validateModuleScopes = (modules, yamlContentByLine, permissions) => {
    const validationErrors = [];
    const scopes = (0, scopes_1.getAllScopeKeys)(permissions?.scopes ?? []);
    module_to_scope_mapping_1.MODULE_TO_SCOPES_MAPPING.forEach((requiredScopes, moduleType) => {
        const modulesToValidate = modules[moduleType];
        if (modulesToValidate) {
            if (!requiredScopes.every((s) => scopes.includes(s))) {
                modulesToValidate.forEach((m) => {
                    validationErrors.push({
                        message: text_1.errors.modules.moduleScopesValidator.missingScopes(moduleType, m.key, requiredScopes),
                        reference: text_1.References.MissingScopes,
                        level: 'error',
                        ...(0, utils_1.findPosition)(m.key, yamlContentByLine)
                    });
                });
            }
        }
    });
    return validationErrors;
};
exports.validateModuleScopes = validateModuleScopes;
