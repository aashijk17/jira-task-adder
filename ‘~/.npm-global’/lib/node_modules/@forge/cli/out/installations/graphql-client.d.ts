/// <reference types="node" />
import { URL } from 'url';
import { AppEnvironmentType, AppUninstallationInput, GraphQLClient, GraphQlMutationError, Maybe, Pause, BaseError, UserError, SupportedProduct, HamsEntitlement, CcpEntitlement, AppInstallationsByAppFilter } from '@forge/cli-shared';
import { AppInstallSiteDetails, InstallAppClient } from './install-app-site';
import { AppEnvironmentVersionData, HasNoAppInstallationsForEnvClient, Installation, InstallationFilterOptions, ListAppInstallationsClient, UpgradeAppInstallationsClient, GetEntitlementOffering } from '../service/installation-service';
import { UninstallAppClient, UninstallAppOutput } from './uninstall-app';
import { SiteTranslator } from './site-translation';
export declare const UNINSTALLATION_EVENT_POLL_INTERVAL = 500;
export declare const ALREADY_UPGRADED_CODE = "INSTALLATION_ALREADY_UPGRADED";
export declare class PermissionDeniedError extends GraphQlMutationError {
    constructor(requestId: string | undefined, appId: string | undefined, statusCode: number | undefined);
}
export declare class AlreadyInstalledError extends GraphQlMutationError {
    readonly hasMajorVersion?: boolean | undefined;
    readonly environment?: string | undefined;
    readonly environmentType?: AppEnvironmentType | undefined;
    constructor(requestId: string | undefined, statusCode: number | undefined, hasMajorVersion?: boolean | undefined, environment?: string | undefined, environmentType?: AppEnvironmentType | undefined);
}
export declare class InstallationError extends GraphQlMutationError {
    constructor(message: string, { requestId, code, statusCode }: {
        requestId: string | undefined;
        code: string | undefined;
        statusCode: number | undefined;
    });
}
export declare class UpgradeError extends GraphQlMutationError {
    constructor(message: string, { requestId, code, statusCode }: {
        requestId: string | undefined;
        code: string | undefined;
        statusCode: number | undefined;
    });
}
export declare class EnvironmentNotFoundError extends UserError {
    constructor(environmentKey: string);
}
export declare class MissingTaskIdError extends Error {
}
export declare class InstallationRequestFailedError extends BaseError {
    private readonly userError;
    readonly code?: string | undefined;
    constructor(userError: boolean, code?: string | undefined, message?: string, requestId?: string | undefined);
    isUserError(): boolean;
}
export declare class MissingAppError extends UserError {
}
export declare class MissingAppEnvironmentError extends Error {
}
export declare class MissingAppUninstallTask extends Error {
}
export declare class InstallationNotFoundError extends UserError {
}
export declare class InstallationsGraphqlClient implements InstallAppClient, ListAppInstallationsClient, UninstallAppClient, UpgradeAppInstallationsClient, GetEntitlementOffering, HasNoAppInstallationsForEnvClient {
    private readonly graphqlClient;
    private readonly sitedProductTranslator;
    private readonly bitbucketTranslator;
    private readonly pause;
    SITE_RESOURCE_TYPE: string;
    WORKSPACE_RESOURCE_TYPE: string;
    static buildInstallationContext(product: string, resourceId: string, resourceType: string): string;
    constructor(graphqlClient: GraphQLClient, sitedProductTranslator: SiteTranslator, bitbucketTranslator: SiteTranslator, pause: Pause);
    private buildInstallationContext;
    private getProductTranslation;
    installAppIntoSite({ environmentKey, site, product, appId, licenseOverride, overrides, majorVersionId, environmentType }: AppInstallSiteDetails): Promise<void>;
    getEntitlementOffering(site: URL, product: SupportedProduct): Promise<Maybe<CcpEntitlement | HamsEntitlement | undefined>>;
    getHamsProductKeys(product: SupportedProduct): string[];
    upgradeInstallation({ site, product, environmentKey, appId, majorVersionId }: AppInstallSiteDetails): Promise<void>;
    private monitorAppInstallOrUpgrade;
    private handleFailedInstallOrUpgrade;
    uninstallApp(input: AppUninstallationInput): Promise<boolean>;
    uninstallMultipleApps(apps: AppUninstallationInput[]): Promise<Partial<UninstallAppOutput>[]>;
    listInstallations(appId: string, installationFilterOptions?: InstallationFilterOptions): Promise<Installation[]>;
    getInstallation(appId: string, installationId: string): Promise<Installation>;
    hasNoAppInstallationsForEnv(appId: string, appEnv: AppEnvironmentType): Promise<boolean>;
    private getAppInstallationTask;
    private getAppInstallationTaskRetry;
    private monitorUninstallApp;
    private getResourceArisForProduct;
    private getCombinedHostnameMap;
    private resolveInstallationsHostnames;
    private getAllInstallations;
    static buildInstallationsFilter(appId: string, installationFilterOptions: InstallationFilterOptions | undefined, buildInstallationContext: (product: string, site: URL) => Promise<string>): Promise<AppInstallationsByAppFilter>;
    getVersions(appId: string, environmentKey: string, firstN?: number): Promise<AppEnvironmentVersionData>;
    getVersionByMajorVersionId(id: string, environmentKey: string, majorVersion?: number): Promise<AppEnvironmentVersionData | undefined>;
}
//# sourceMappingURL=graphql-client.d.ts.map