/// <reference types="node" />
import { AppConfigProvider, AppEnvironmentType, AppEnvironmentVersion, Maybe, SupportedProduct, BaseError, HamsEntitlement, CcpEntitlement } from '@forge/cli-shared';
import { URL } from 'url';
import { AppInstallSiteDetails } from '../installations/install-app-site';
export interface Installation {
    id: string;
    product: string;
    secondaryProducts?: string[];
    site: string;
    environmentKey: string;
    environmentType: AppEnvironmentType;
    context: string;
    secondaryContexts?: string[];
    version: {
        isLatest: boolean;
        version: string;
        scopes: string[];
    };
}
export interface AppInstallation {
    installations: Installation[];
}
export interface AppEnvironmentVersionPermissions {
    scopes: string[];
    egressAddresses: string[];
    requiredProducts?: string[];
}
export interface AppEnvironmentPermissions extends AppEnvironmentVersionPermissions {
    addedScopes: string[];
    environmentType: AppEnvironmentType;
    hasDeployments: boolean;
    isLatest?: boolean;
    version?: string;
    versionId?: string;
}
export interface InstallationFilterOptions {
    site?: URL;
    product?: SupportedProduct;
    environment?: string;
    installationId?: string;
}
export interface AppEnvironmentVersionData {
    nodes?: Array<Maybe<AppEnvironmentVersion>> | null;
    environmentType: AppEnvironmentType;
}
export interface ListAppInstallationsClient {
    listInstallations(appId: string, installationFilterOptions?: InstallationFilterOptions): Promise<Installation[]>;
    getVersions(appId: string, environmentKey: string, firstN: number): Promise<AppEnvironmentVersionData>;
}
export interface GetEntitlementOffering {
    getEntitlementOffering(site: URL, product: SupportedProduct): Promise<Maybe<CcpEntitlement> | Maybe<HamsEntitlement> | undefined>;
}
export interface UpgradeAppInstallationsClient {
    upgradeInstallation({ site, product, environmentKey, appId }: AppInstallSiteDetails): Promise<void>;
}
export interface HasNoAppInstallationsForEnvClient {
    hasNoAppInstallationsForEnv(appId: string, appEnv: AppEnvironmentType): Promise<boolean>;
}
export interface GetVersionByMajorVersionIdClient {
    getVersionByMajorVersionId(id: string, environmentKey: string, majorVersion: number): Promise<AppEnvironmentVersionData | undefined>;
}
export declare class MultipleMatchingInstallationsError extends BaseError {
    constructor();
}
export declare class InstallationService {
    private readonly getAppConfig;
    private readonly listInstallationsClient;
    private readonly upgradeAppInstallationsClient;
    private readonly hasNoAppInstallationsForEnvClient;
    private readonly getEntitlementOffering;
    private readonly getVersionByMajorVersionIdClient;
    constructor(getAppConfig: AppConfigProvider, listInstallationsClient: ListAppInstallationsClient, upgradeAppInstallationsClient: UpgradeAppInstallationsClient, hasNoAppInstallationsForEnvClient: HasNoAppInstallationsForEnvClient, getEntitlementOffering: GetEntitlementOffering, getVersionByMajorVersionIdClient: GetVersionByMajorVersionIdClient);
    private comparePossibleInstallations;
    private matchSiteForProduct;
    private filterInstallations;
    listAppInstallations(filter?: InstallationFilterOptions): Promise<AppInstallation>;
    hasNoAppInstallationsForEnv(appEnv: AppEnvironmentType): Promise<boolean>;
    listNonTechnicalAppInstallations(filter?: InstallationFilterOptions): Promise<AppInstallation>;
    findOnlyMatchingInstallation(filter: InstallationFilterOptions): Promise<Installation>;
    hasOutdatedProductInstallation(environment: string): Promise<boolean>;
    getEntitlementOfferingProduct(site: URL, product: SupportedProduct): Promise<Maybe<CcpEntitlement> | Maybe<HamsEntitlement> | undefined>;
    upgradeInstallation(site: URL, product: string, environmentKey: string, appId: string): Promise<boolean>;
    getVersionByMajorVersionId(id: string, environmentKey: string, majorVersion: number): Promise<AppEnvironmentPermissions | undefined>;
    private getPermissionsFromAppEnvironmentVersion;
    getAppEnvironmentPermissions(appId: string, environmentKey: string): Promise<AppEnvironmentPermissions | undefined>;
}
//# sourceMappingURL=installation-service.d.ts.map