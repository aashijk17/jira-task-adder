"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConfigFilePortFindingService = void 0;
const portfinder_1 = require("portfinder");
class ConfigFilePortFindingService {
    configFile;
    constructor(configFile) {
        this.configFile = configFile;
    }
    async findPorts(minPort) {
        const resources = await this.configFile.getResources();
        const resourceKeys = resources.map((resource) => resource.key);
        if (!resourceKeys.length)
            return {};
        const portOptions = {};
        if (minPort) {
            portOptions['port'] = minPort + 1;
        }
        const ports = await (0, portfinder_1.getPortsPromise)(resourceKeys.length, portOptions);
        const portMap = {};
        Array.from(new Set(resourceKeys)).forEach((resourceKey, idx) => {
            portMap[resourceKey] = ports[idx];
        });
        return portMap;
    }
    async findPortAfter(portsTaken) {
        if (!portsTaken.length)
            return undefined;
        const max = Math.max(...portsTaken);
        return (await (0, portfinder_1.getPortsPromise)(1, { port: max + 1 }))[0];
    }
}
exports.ConfigFilePortFindingService = ConfigFilePortFindingService;
//# sourceMappingURL=port-finding-service.js.map